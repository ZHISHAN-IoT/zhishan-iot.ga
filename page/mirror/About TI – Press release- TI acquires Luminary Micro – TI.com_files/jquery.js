(function(h){h.fn.extend({RSSer:function(e){function w(b){if(typeof b=="string"&&b.length>10&&b.indexOf("?")>10)return b+"&ts="+(new Date).getTime().toString()}function x(b,m,l,q,n,i){var j=0;b.find("title:first").text();var c=[];b.find("item").each(function(){if(j<n&&j>=i-1){var a=jQuery(this),g={},f;g.title=h.trim(a.find("title").text());g.link=h.trim(a.find("link").text());g.description=h.trim(a.find("description").text());g.pubdate=h.trim(a.find("pubDate").text());g.guid=h.trim(a.find("guid").text());
c.push(g.guid);a=l;a=a.replace(/\[title\]/ig,g.title);a=a.replace(/\[link\]/ig,g.link);a=a.replace(/\[description\]/ig,g.description);a=a.replace(/\[pubdate\]/ig,g.pubdate);a=a.replace(/\[guid\]/ig,g.guid);for(f in e.addedTemplateTokens){var d=e.addedTemplateTokens[f];d=d.processFn(g[d.dataField]);a=a.replace(RegExp("\\["+f+"\\]","g"),d)}m.append(a)}j++});e.callback(c)}function y(b,m,l,q,n,i){var j=0;b.find("title:first").text();var c=[];b.find("entry").each(function(){if(j<n&&j>=i-1){var a={},g;
a.entry=jQuery(this);a.title=h.trim(a.entry.find("title").text());a.link=h.trim(a.entry.find("link").attr("href"));a.summary=h.trim(a.entry.find("summary").text());a.pubdate=h.trim(a.entry.find("published").text());a.guid=h.trim(a.entry.find("guid").text());c.push(a.guid);var f=l;f=f.replace(/\[title\]/ig,a.title);f=f.replace(/\[link\]/ig,a.link);f=f.replace(/\[description\]/ig,a.summary);f=f.replace(/\[pubdate\]/ig,a.pubdate);f=f.replace(/\[guid\]/ig,a.guid);for(g in e.addedTemplateTokens){var d=
e.addedTemplateTokens[g];d=d.processFn(a[d.dataField]);f=f.replace(RegExp("\\["+g+"\\]","g"),d)}m.append(f)}j++});e.callback(c)}function u(b,m){var l=e.template,q=e.charLimit,n=e.maxItems,i=e.dateformatter;i=e.removeTime;var j=e.startItem;b=h(b);if(b.find("feed").length==1){if(i)i=function(c){return c.substr(0,c.indexOf("T"))};y(b,m,l,q,n,j)}else{if(i)i=function(c){return c.replace(/[0-9]{1,2}:[0-9]{1,2}:[0-9]{1,2} [A-Z]{3}/i,"")};x(b,m,l,q,n,j)}}function z(b,m,l,q,n,i,j){h.ajax({type:"GET",url:l,
dataType:"html",error:function(){b.append(j)},success:function(c){c=c.substring(c.indexOf("<item>"),c.lastIndexOf("</item>"));c=c.replace(/<\/item>/g,"");c=c.split("<item>");var a=0,g=Math.min(c.length,n+1),f=[];for(a=Math.min(g,i);a<g;a++){var d=c[a],p=d.substring(d.indexOf("<title>"),d.lastIndexOf("</title>"));p=p.replace(/<title>/g,"");var r=d.substring(d.indexOf("<link>"),d.lastIndexOf("</link>"));r=r.replace(/<link>/g,"");var s=d.substring(d.indexOf("<pubDate>"),d.lastIndexOf("</pubDate>"));
s=s.replace(/<pubDate>/g,"");var o=d.substring(d.indexOf("<description>"),d.lastIndexOf("</description>"));o=o.replace(/\&lt\;/g,"<");o=o.replace(/\&gt\;/g,">");o=o.replace(/\&amp\;/g,"&");o=o.replace(/<\/[^>]*>/g," ").replace(/<[^>]*>/g,"");var v=d.substring(d.indexOf('<guid isPermaLink="false">'),d.lastIndexOf("</guid>"));f.push(v);var k=m,t;k=k.replace(/\[title\]/ig,p);k=k.replace(/\[link\]/ig,r);k=k.replace(/\[description\]/ig,o);k=k.replace(/\[pubdate\]/ig,s);k=k.replace(/\[guid\]/ig,v);for(t in e.addedTemplateTokens){p=
e.addedTemplateTokens[t];p=p.processFn(d[p.dataField]);k=k.replace(RegExp("\\["+t+"\\]","g"),p)}b.append(k)}e.callback(f)}})}e=h.extend({errormsg:"<li>Error</li>",template:'<li><b><a name="&lid=EN-US-[linkid]" href="[link]">[title]</a> - [pubdate]</b><br/>[description]</li>',rssURL:"",maxItems:5,startItem:1,addedTemplateTokens:{example:{dataField:"title",processFn:function(b){return b}}},callback:function(){}},e);return this.each(function(){var b=h(this),m=e.template,l=w(e.rssURL),q=e.charLimit,n=
e.maxItems,i=e.errormsg,j=e.startItem;if(window.XDomainRequest){var c=new XDomainRequest;c.open("get",l);c.onload=function(){u(h.parseXML(c.responseText),b)};c.send()}else{h.support.cors=true;h.ajax({type:"GET",url:l,dataType:"xml",crossDomain:true,crossOrigin:true,contentType:"text/plain",error:function(a){a.status==200?z(b,m,l,q,n,j,i):b.append(i)},success:function(a){u(a,b)}})}})}})})(jQuery);
